!function(){"use strict";function t(t,e,a){const n=[];for(let i=e;i<e+a;i++)n.push(t[i]);return n}const e=0,a=1;function n(n,i,s,o=a){const l=t(n,i,s);return o===e&&l.reverse(),l.reduce(((t,e)=>256*t+e),0)}function i(t,e,a){return t<=e?e:t>=a?a:t}function s(t){return t>=32768?t-65536:t}var o=Object.freeze({__proto__:null,Brstm:class{constructor(i){if(this.rawData=new Uint8Array(i),"RSTM"!==function(n,i,s,o=a){const l=t(n,i,s);return o===e&&l.reverse(),String.fromCharCode(...l)}(this.rawData,0,4))throw new Error("Not a valid BRSTM file");this.endianness=function(n){const i=t(n,4,2);return 255===i[0]&&254===i[1]?e:a}(this.rawData),this._offsetToHead=n(this.rawData,16,4,this.endianness),this._offsetToHeadChunk1=this._offsetToHead+n(this.rawData,this._offsetToHead+12,4,this.endianness)+8,this._offsetToHeadChunk2=this._offsetToHead+n(this.rawData,this._offsetToHead+20,4,this.endianness)+8,this._offsetToHeadChunk3=this._offsetToHead+n(this.rawData,this._offsetToHead+28,4,this.endianness)+8,this._offsetToAdpc=n(this.rawData,24,4,this.endianness),this._offsetToData=n(this.rawData,32,4,this.endianness),this.metadata=this._getMetadata(),this._cachedSamples=null,this._partitionedAdpcChunkData=null,this._cachedChannelInfo=null,this._cachedBlockResults=[]}_getChannelInfo(){if(this._cachedChannelInfo)return this._cachedChannelInfo;const{numberChannels:t}=this.metadata,e=[];for(let a=0;a<t;a++){const t=this._offsetToHead+n(this.rawData,this._offsetToHeadChunk3+8+8*a,4,this.endianness)+8+8,i=[];for(let e=0;e<16;e++){const a=n(this.rawData,t+2*e,2,this.endianness);i.push(s(a))}e.push({adpcmCoefficients:i,gain:n(this.rawData,t+40,2,this.endianness),initialPredictorScale:n(this.rawData,t+42,2,this.endianness),historySample1:n(this.rawData,t+44,2,this.endianness),historySample2:n(this.rawData,t+46,2,this.endianness),loopPredictorScale:n(this.rawData,t+48,2,this.endianness),loopHistorySample1:n(this.rawData,t+50,2,this.endianness),loopHistorySample2:n(this.rawData,t+52,2,this.endianness)})}return this._cachedChannelInfo=e,e}_getMetadata(){const t=n(this.rawData,this._offsetToHeadChunk1+2,1,this.endianness);return{fileSize:n(this.rawData,8,4,this.endianness),endianness:this.endianness,codec:n(this.rawData,this._offsetToHeadChunk1,1,this.endianness),loopFlag:n(this.rawData,this._offsetToHeadChunk1+1,1,this.endianness),numberChannels:t,sampleRate:n(this.rawData,this._offsetToHeadChunk1+4,2,this.endianness),loopStartSample:n(this.rawData,this._offsetToHeadChunk1+8,4,this.endianness),totalSamples:n(this.rawData,this._offsetToHeadChunk1+12,4,this.endianness),totalBlocks:n(this.rawData,this._offsetToHeadChunk1+20,4,this.endianness),blockSize:n(this.rawData,this._offsetToHeadChunk1+24,4,this.endianness),samplesPerBlock:n(this.rawData,this._offsetToHeadChunk1+28,4,this.endianness),finalBlockSize:n(this.rawData,this._offsetToHeadChunk1+32,4,this.endianness),finalBlockSizeWithPadding:n(this.rawData,this._offsetToHeadChunk1+40,4,this.endianness),totalSamplesInFinalBlock:n(this.rawData,this._offsetToHeadChunk1+36,4,this.endianness),adpcTableSamplesPerEntry:n(this.rawData,this._offsetToHeadChunk1+44,4,this.endianness),adpcTableBytesPerEntry:n(this.rawData,this._offsetToHeadChunk1+48,4,this.endianness),numberTracks:n(this.rawData,this._offsetToHeadChunk2,1,this.endianness),trackDescriptionType:n(this.rawData,this._offsetToHeadChunk2+1,1,this.endianness)}}_getPartitionedBlockData(t){const{blockSize:e,totalBlocks:a,numberChannels:n,finalBlockSize:i,finalBlockSizeWithPadding:s}=this.metadata,o=[];for(let s=0;s<n;s++)o.push(new Uint8Array(t===a-1?i:e));let l=t;for(let t=0;t<n;t++){const r=0!==t&&l+1===a?l*n*e+t*s:(l*n+t)*e,u=l+1===a?r+i:r+e,h=this.rawData.slice(this._offsetToData+32+r,this._offsetToData+32+u);o[t].set(h)}return o}_getPartitionedAdpcChunkData(){if(this._partitionedAdpcChunkData)return this._partitionedAdpcChunkData;const{totalBlocks:t,numberChannels:e}=this.metadata,a=n(this.rawData,this._offsetToAdpc+4,4,this.endianness),i=this.rawData.slice(this._offsetToAdpc+8,this._offsetToAdpc+8+a);let o=0,l=0,r=0;for(let t=0;t<e;t++)l=s(n(i,o,2,this.endianness)),o+=2,r=s(n(i,o,2,this.endianness)),o+=2;const u=[];for(let a=0;a<t;a++){u.push([]);for(let t=0;t<e;t++)a>0&&(l=s(n(i,o,2,this.endianness)),o+=2,r=s(n(i,o,2,this.endianness)),o+=2),u[a].push({yn1:l,yn2:r})}let h=[];for(let t=0;t<e;t++)h.push(u.map((e=>e[t])));return this._partitionedAdpcChunkData=h,h}getAllSamples(){if(this._cachedSamples)return this._cachedSamples;const{numberChannels:t,totalSamples:e,totalBlocks:a,samplesPerBlock:n}=this.metadata,i=[];for(let a=0;a<t;a++)i.push(new Int16Array(e));for(let e=0;e<a;e++){const a=this._getSamplesAtBlock(e);for(let s=0;s<t;s++)i[s].set(a[s],e*n)}return this._cachedSamples=i,i}_getSamplesAtBlock(t){if(this._cachedBlockResults[t])return this._cachedBlockResults[t];const{numberChannels:e,totalBlocks:a,totalSamplesInFinalBlock:o,samplesPerBlock:l,codec:r}=this.metadata,u=this._getChannelInfo(),h=this._getPartitionedBlockData(t),c=this._getPartitionedAdpcChunkData(),f=[],d=t===a-1?o:l;for(let t=0;t<e;t++)f.push(new Int16Array(d));for(let o=0;o<e;o++){const{adpcmCoefficients:e}=u[o],l=h[o],p=[];if(2===r){const n=l[0],{yn1:s,yn2:r}=c[o][t];let u=n,h=s,f=r,m=0;for(let t=0;t<d;){let a=0;t%14==0&&(u=l[m++]),a=0==(1&t++)?l[m]>>4:15&l[m++],a>=8&&(a-=16);const n=u>>4<<1;a=1024+((1<<(15&u))*a<<11)+e[i(n,0,15)]*h+e[i(n+1,0,15)]*f>>11,f=h,h=i(a,-32768,32767),p.push(h)}t<a-1&&(c[o][t+1].yn1=p[d-1],c[o][t+1].yn2=p[d-2])}else if(1===r)for(let t=0;t<d;t++){const e=s(n(l,2*t,2,this.endianness));p.push(e)}else{if(0!==r)throw new Error("Invalid codec");for(let t=0;t<d;t++)p.push(s(l[t]))}f[o].set(p)}return this._cachedBlockResults[t]=f,f}getBuffer(t,e){return this.getSamples(t,e)}getSamples(t,e){const{numberChannels:a,totalBlocks:n,totalSamples:i,samplesPerBlock:s}=this.metadata,o=Math.max(0,t),l=Math.min(i,t+e),r=Math.max(0,Math.floor(o/s)),u=Math.min(n-1,Math.floor(l/s)),h=[];for(let t=r;t<=u;t++)h.push(this._getSamplesAtBlock(t));const c=[];for(let t=0;t<a;t++)c.push(new Int16Array(l-o));for(let t=r;t<=u;t++){const n=t-r;if(t===r&&t===u)for(let t=0;t<a;t++)c[t].set(h[n][t].slice(o-r*s,o-r*s+e),0);else if(t===r)for(let t=0;t<a;t++){const e=h[n][t].slice(o-r*s);c[t].set(e,0)}else if(t===u)for(let i=0;i<a;i++){const a=h[n][i].slice(0,l-h[n][i].length-r*s);a.length+(t*s-o)>c[i].length?c[i].set(a.slice(0,e-(t*s-o)),t*s-o):c[i].set(a,t*s-o)}else for(let e=0;e<a;e++)c[e].set(h[n][e],t*s-o)}return c}}}),l={STREAMING_MIN_RESPONSE:2**19},r=function(t,e){let a=this.getChannelData(e);for(let e=0;e<t.length;e++)a[e]=t[e]};function u(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})})),e}let h=!1,c="",f=null,d=new Map,p=new Map;function m(t,e){let a=f.getBoundingClientRect(),n=t-a.x,i=e-a.y;return n<0&&(n=0),i<0&&(i=0),n>a.width&&(n=a.width),i>a.height&&(i=a.height),[n,i]}function g(t,e,a){if(d.has(t))for(let n=0;n<d.get(t).length;n++)d.get(t)[n](e,a)}var y,w=function(t,e){if(d.has(t)){let a=d.get(t);a.push(e),d.set(t,a)}else d.set(t,[e])},v=function(t,e){if(p.has(t)){let a=p.get(t);a.push(e),p.set(t,a)}else p.set(t,[e])},S=function(){document.addEventListener("mousedown",(function(t){if(t.target.dataset.gestureHitzone){h=!0,c=t.target.dataset.gestureHitzone,f=t.target;let[e,a]=m(t.clientX,t.clientY);g(c,e,a)}})),document.addEventListener("mousemove",(function(t){if(h){let[e,a]=m(t.clientX,t.clientY);g(c,e,a)}})),document.addEventListener("mouseup",(function(t){if(h){let[e,a]=m(t.clientX,t.clientY);!function(t,e,a){if(p.has(t))for(let n=0;n<p.get(t).length;n++)p.get(t)[n](e,a)}(c,e,a),h=!1,f=null,c=""}}))},k=(function(t){let e={position:0,samples:1e6,loaded:5e5,volume:1,paused:!1,ready:!1,buffering:!1,sampleRate:48e3,looping:!1,streamingDied:!1},a={volume:null,position:null},n={},i=null,s=null,o=null,l=-30;function r(i){try{i.preventDefault()}catch(t){}if(i.targetTouches.length>0){let s=i.targetTouches[0].target.getBoundingClientRect(),o=i.targetTouches[0].clientY+i.targetTouches[0].radiusY-s.top;o<5&&(o=0),o>80&&(o=84);let l=1-o/84;a.volume=l,"touchend"===i.type&&(e.volume=a.volume,n.setVolume(a.volume),a.volume=null,localStorage.setItem("volumeoverride",l)),t.exports.guiUpdate()}else"touchend"===i.type&&(e.volume=a.volume,n.setVolume(a.volume),a.volume=null)}function u(i){try{i.preventDefault()}catch(t){}if(i.targetTouches.length>0){let s=i.targetTouches[0].target.getBoundingClientRect(),o=i.targetTouches[0].clientX+i.targetTouches[0].radiusX-s.left;if(o<5&&(o=0),o>254&&(o=254),o=Math.round(o),o===l)return;l=o;let r=e.samples*(o/254);r<e.loaded&&(a.position=r),"touchend"===i.type&&(n.seek(a.position),a.position=null),t.exports.guiUpdate()}else"touchend"===i.type&&(n.seek(a.position),a.position=null)}function h(n,i){let s=Math.round(n),o=e.samples*(s/254);o<e.loaded&&(a.position=o),t.exports.guiUpdate()}function c(i,s){let o=Math.round(i),l=e.samples*(o/254);l<e.loaded&&(a.position=l),n.seek(l),a.position=null,t.exports.guiUpdate()}function f(e,n){n=Math.round(n),a.volume=1-n/84,t.exports.guiUpdate()}function d(e,i){let s=1-(i=Math.round(i))/84;a.volume=null,localStorage.setItem("volumeoverride",s),n.setVolume(s),t.exports.guiUpdate()}t.exports.updateState=function(t){Object.assign(e,t)},t.exports.runGUI=function(a){n=a,o=document.createElement("div"),o.classList.add("guiholder"),o.innerHTML='\n<div class="error" style="display: none">\n    <h3>Playback failed!</h3>\n    <h3>Reload the page and try again.</h3>\n    <h3>If the issue continues, contact us.</h3>\n</div>\n<div id="gui-loading-bar">\n    <div id="gui-inner-loading-bar"></div>\n</div>\n<div class="guistate" data-guistate="preload">\n    <h3>Loading song...</h3>\n</div>\n<div class="guistate" data-guistate="ready">\n    <div id="pl-pause-play">\n        <svg width="48" height="48" viewBox="0 0 48 48" id="pl-play">\n            <path d="M 10, 10 l 0, 28 l 28, -14" fill="white"></path>\n        </svg>\n        <svg width="48" height="48" viewBox="0 0 48 48" id="pl-pause" style="display: none;">\n            <path d="M 10, 10 l 0, 28 l 10, 0 l 0, -28 M 28, 10 l 0, 28 l 10, 0 l 0, -28" fill="white"></path>\n        </svg>\n    </div>\n    <canvas id="pl-volume" width="16" height="84" data-gesture-hitzone="volume"></canvas>\n    <div id="pl-timing">\n        <span id="pl-time-start">0:00</span>\n        <span id="pl-time-end"  >0:00</span>\n    </div>\n    <canvas id="pl-seek" width="254" height="16" data-gesture-hitzone="seek"></canvas>\n    <div id="pl-loop">\n        <input type="checkbox" id="pl-loop-box" style="width: 16px; height: 16px; margin: 0;">\n        <span class="pl-loop-text">Enable loop</span>\n        <a class="pl-loop-text" target="_blank" href="https://smashcustommusic.net/feedback/">Send feedback</a>\n        <a class="pl-loop-text" target="_blank" href="https://github.com/rphsoftware/revolving-door">v2 by Rph</a>\n    </div>\n</div>',document.body.appendChild(o),i=document.querySelector("#pl-volume").getContext("2d"),s=document.querySelector("#pl-seek").getContext("2d"),document.querySelector("#pl-volume").addEventListener("touchstart",r),document.querySelector("#pl-volume").addEventListener("touchmove",r),document.querySelector("#pl-volume").addEventListener("touchend",r),document.querySelector("#pl-seek").addEventListener("touchstart",u),document.querySelector("#pl-seek").addEventListener("touchmove",u),document.querySelector("#pl-seek").addEventListener("touchend",u),document.querySelector("#pl-pause-play").addEventListener("click",(function(){n.pause(),t.exports.guiUpdate()})),document.querySelector("#pl-loop-box").addEventListener("input",(function(){e.looping=document.querySelector("#pl-loop-box").checked,n.setLoop(e.looping)})),o.addEventListener("drag",(function(t){t.preventDefault()})),S(),w("seek",h),v("seek",c),w("volume",f),v("volume",d)};let p=null,m=null,g=-1,y=-1,k=null,b=-1,T=-1,_=null,C=-1,B=null;t.exports.guiUpdate=function(){if(o){B!==e.streamingDied&&(o.querySelector(".error").style.display=e.streamingDied?"flex":"none",B=e.streamingDied);let t=e.buffering||!e.ready;if(p!==t&&(o.querySelector("#gui-loading-bar").dataset.exists=t,p=t),m!==e.ready&&(o.querySelector('.guistate[data-guistate="preload"]').style.display=e.ready?"none":"block",o.querySelector('.guistate[data-guistate="ready"]').style.display=e.ready?"grid":"none",m=e.ready),!e.ready)return;let n=Math.round(84-84*e.volume);null!==a.volume&&(n=Math.round(84-84*a.volume)),n!==g&&(i.fillStyle="#444",i.fillRect(0,0,16,84),i.fillStyle="hsl(200, 85%, 55%)",i.fillRect(0,n,16,84),g=n);let l=Math.ceil(e.position/e.samples*254);null!==a.position&&(l=Math.ceil(a.position/e.samples*254));let r=Math.ceil(e.loaded/e.samples*254);l===y&&r===C||(s.fillStyle="#222",s.fillRect(0,0,254,16),s.fillStyle="#666",s.fillRect(0,0,Math.min(254,r),16),s.fillStyle="hsl(200, 85%, 55%)",s.fillRect(0,0,Math.min(254,l),16),y=l,C=r),k!==e.paused&&(o.querySelector("#pl-pause").style.display=e.paused?"none":"block",o.querySelector("#pl-play").style.display=e.paused?"block":"none",k=e.paused);let u=Math.floor(e.samples/e.sampleRate),h=Math.floor(e.position/e.sampleRate);null!==a.position&&(h=Math.floor(a.position/e.sampleRate)),u!==b&&(o.querySelector("#pl-time-end").innerText=`${Math.floor(u/60)}:${(u%60).toString().padStart(2,"0")}`,b=u),h!==T&&(o.querySelector("#pl-time-start").innerText=`${Math.floor(h/60)}:${(h%60).toString().padStart(2,"0")}`,T=h),_!==e.looping&&(o.querySelector("#pl-loop-box").checked=e.looping,_=e.looping)}}}(y={exports:{}},y.exports),y.exports),b=u(o);function T(t,e,a,n){if(this.fromSampleRate=+t,this.toSampleRate=+e,this.channels=0|a,"object"!=typeof n)throw new Error("inputBuffer is not an object.");if(!(n instanceof Array||n instanceof Float32Array||n instanceof Float64Array))throw new Error("inputBuffer is not an array or a float32 or a float64 array.");this.inputBuffer=n,this.initialize()}T.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1,this.outputBuffer=this.inputBuffer):(this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.initializeBuffers())},T.prototype.compileLinearInterpolationFunction=function(){for(var t="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = this.lastWeight;        var firstWeight = 0;        var secondWeight = 0;        var sourceOffset = 0;        var outputOffset = 0;        var outputBuffer = this.outputBuffer;        for (; weight < 1; weight += "+this.ratioWeight+") {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;",e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = (this.lastOutput["+e+"] * firstWeight) + (buffer["+e+"] * secondWeight);";t+="}        weight -= 1;        for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; sourceOffset < bufferLength;) {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;";for(e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(e>0?" + "+e:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+e)+"] * secondWeight);";t+="weight += "+this.ratioWeight+";            sourceOffset = Math.floor(weight) * "+this.channels+";        }";for(e=0;e<this.channels;++e)t+="this.lastOutput["+e+"] = buffer[sourceOffset++];";t+="this.lastWeight = weight % 1;    }    return outputOffset;",this.resampler=Function("bufferLength",t)},T.prototype.compileMultiTapFunction=function(){for(var t="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = 0;",e=0;e<this.channels;++e)t+="var output"+e+" = 0;";for(t+="var actualPosition = 0;        var amountToNext = 0;        var alreadyProcessedTail = !this.tailExists;        this.tailExists = false;        var outputBuffer = this.outputBuffer;        var currentPosition = 0;        do {            if (alreadyProcessedTail) {                weight = "+this.ratioWeight+";",e=0;e<this.channels;++e)t+="output"+e+" = 0;";for(t+="}            else {                weight = this.lastWeight;",e=0;e<this.channels;++e)t+="output"+e+" = this.lastOutput["+e+"];";for(t+="alreadyProcessedTail = true;            }            while (weight > 0 && actualPosition < bufferLength) {                amountToNext = 1 + actualPosition - currentPosition;                if (weight >= amountToNext) {",e=0;e<this.channels;++e)t+="output"+e+" += buffer[actualPosition++] * amountToNext;";for(t+="currentPosition = actualPosition;                    weight -= amountToNext;                }                else {",e=0;e<this.channels;++e)t+="output"+e+" += buffer[actualPosition"+(e>0?" + "+e:"")+"] * weight;";for(t+="currentPosition += weight;                    weight = 0;                    break;                }            }            if (weight <= 0) {",e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = output"+e+" / "+this.ratioWeight+";";for(t+="}            else {                this.lastWeight = weight;",e=0;e<this.channels;++e)t+="this.lastOutput["+e+"] = output"+e+";";t+="this.tailExists = true;                break;            }        } while (actualPosition < bufferLength);    }    return outputOffset;",this.resampler=Function("bufferLength",t)},T.prototype.bypassResampler=function(t){return t},T.prototype.initializeBuffers=function(){var t=Math.ceil(this.inputBuffer.length*this.toSampleRate/this.fromSampleRate/this.channels*1.0000004768371582)*this.channels+this.channels;try{this.outputBuffer=new Float32Array(t),this.lastOutput=new Float32Array(this.channels)}catch(t){this.outputBuffer=[],this.lastOutput=[]}};const{STREAMING_MIN_RESPONSE:_}=l;function C(t,e,a){let n=[],i=0;for(let e=0;e<t.metadata.numberChannels;e++)n.push(new Int16Array(a));for(;i<a;){let s=t.getSamples(e+i,Math.min(t.metadata.samplesPerBlock,a-i));for(let t=0;t<s.length;t++)n[t].set(s[t],i);i+=Math.min(t.metadata.samplesPerBlock,a-i)}return n}let B=!1,R=null,D=null,M=null,x=null,A=!0,E=0,P=0,L=null,H=null,I=!1,O=!1,W=!1,z=!1,F=0,q=localStorage.getItem("volumeoverride")||1;function N(){k.updateState({position:P,paused:I,volume:q,loaded:F,looping:O})}async function U(t){let e=await fetch(t),a=await e.arrayBuffer();L=new b.Brstm(a),A=!0,E=Number.MAX_SAFE_INTEGER,F=Number.MAX_SAFE_INTEGER}function j(t){return new Promise((async(e,a)=>{let n,i;try{n=await fetch(t),i=(await n.body).getReader()}catch(t){return a(t)}H=new ArrayBuffer(parseInt(n.headers.get("content-length")));let s=new Uint8Array(H),o=0,l=!1,r=0;for(F=0,A=!1,W=!1;;){let t;try{t=await i.read()}catch(t){return void(l?(k.updateState({streamingDied:!0,buffering:!1,ready:!0}),await D.close(),D=null):a(t))}if(W)return await i.cancel(),void window.postMessage("continueload");if(t.done){if(!l)try{L=new b.Brstm(H),e(),l=!0}catch(t){return void a(t)}A=!0,F=Number.MAX_SAFE_INTEGER,console.log("File finished streaming");break}if(s.set(t.value,o),o+=t.value.length,E=o,0==r&&o>128){let t=0;65279==256*s[4]+s[5]&&(t=1),r=1==t?16777216*s[112]+65536*s[113]+256*s[114]+s[115]:s[112]+256*s[113]+65536*s[114]+16777216*s[115],r<144&&(r=_)}if(!l&&0!=r&&o>r)try{L=new b.Brstm(H),e(),l=!0}catch(t){return void a(t)}l&&(F=Math.floor((E-r)/L.metadata.numberChannels/L.metadata.blockSize)*L.metadata.samplesPerBlock)}}))}const G={setVolume:function(t){q=t,N(),x&&x.gain.setValueAtTime(q,D.currentTime)},seek:function(t){P=Math.floor(t),N()},pause:function(){I=!I,D[I?"suspend":"resume"](),N()},setLoop:function(t){O=t,N()}};window.player={play:async function(t){if(B||(R=await async function(){let t={sampleRate:!1,streaming:!1};try{let e=new(window.AudioContext||window.webkitAudioContext)({sampleRate:8e3});t.sampleRate=8e3===e.sampleRate,e.close().then((()=>console.log("Closed capability detection audio context.")))}catch(t){console.log("WebAudio sample rate capability detection failed. Assuming fallback.")}try{let e=new Uint8Array(65536),a=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(a),i=await fetch(n);const s=(await i.body).getReader();for(;!(await s.read()).done;);t.streaming=!0}catch(t){console.log("Streaming capability detection failed. Assuming fallback.")}var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),a=!!e&&parseInt(e[2],10);return!1!==a&&a>=89&&(t.sampleRate=!1,console.log("Chrome 89 or newer detected, using audio code workarounds.")),t}(),B=!0,k.runGUI(G),setInterval((function(){k.updateState({loaded:F}),k.guiUpdate()}),100)),z)return;var e,a,n;z=!0,A||(console.log("Cancelling last stream..."),W=!0,await(e="continueload",new Promise((function(t){window.addEventListener("message",(function a(n){n.data===e&&n.isTrusted&&(window.removeEventListener("message",a),t())}))}))),console.log("Done.")),D&&(await D.close(),D=null),P=0,I=!1,k.updateState({ready:!1,position:0,samples:1e6,loaded:0,volume:q,paused:!1,buffering:!1,sampleRate:44100,streamingDied:!1});try{await(R.streaming?j:U)(t)}catch(t){return k.updateState({streamingDied:!0,ready:!0,buffering:!1}),console.error(t),void(z=!1)}D=new(window.AudioContext||window.webkitAudioContext)(R.sampleRate?{sampleRate:L.metadata.sampleRate}:{}),O=1===L.metadata.loopFlag,await(a=D,new Promise((async function(t){let e=!1,n=document.createElement("div");n.style="background: #888a; z-index: 88888; position: fixed; top: 0; bottom: 0; left: 0; right: 0; display: flex; align-items: center; justify-content: center;";let i=document.createElement("div");i.style="display: flex; align-items: center; justify-content: center; flex-direction: column",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" version="1.0"  width="200" height="200" viewBox="0 0 75 75">\n<path d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z"\nstyle="stroke:#fff;stroke-width:5;stroke-linejoin:round;fill:#fff;"\n/>\n<path d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6" style="fill:none;stroke:#fff;stroke-width:5;stroke-linecap:round"/>\n</svg><h1 style="font-family: sans-serif; color: white; margin: 0;">Tap or click anywhere to enable audio.</h1>',n.appendChild(i),setTimeout((function(){e||document.body.appendChild(n)}),200),a.onstatechange=function(){"running"==a.state&&(t(),n.remove(),e=!0)};try{a.resume()}catch(t){console.error(t)}n.addEventListener("touchend",(async function(){await a.resume(),"running"===a.state&&(t(),n.remove(),e=!0)})),n.addEventListener("click",(async function(){await a.resume(),"running"===a.state&&(t(),n.remove(),e=!0)})),"running"===a.state&&(t(),n.remove(),e=!0)}))),R.streaming&&await(n=1e3,new Promise((t=>setTimeout(t,n)))),M=D.createScriptProcessor(0,0,2);let i=M.bufferSize;var s,o,l;i=R.sampleRate?i:(s=D.sampleRate,o=L.metadata.sampleRate,l=i,Math.ceil(l/s*o));let u=i;R.sampleRate||(u+=20),k.updateState({ready:!0,samples:L.metadata.totalSamples}),k.updateState({sampleRate:L.metadata.sampleRate}),z=!1,M.onaudioprocess=function(t){N();let e,a=t.outputBuffer;if(a.copyToChannel||(a.copyToChannel=r),P+i+1024>F)return k.updateState({buffering:!0}),console.log("Buffering...."),a.copyToChannel(new Float32Array(M.bufferSize).fill(0),0),void a.copyToChannel(new Float32Array(M.bufferSize).fill(0),1);if(k.updateState({buffering:!1}),I)return a.copyToChannel(new Float32Array(M.bufferSize).fill(0),0),void a.copyToChannel(new Float32Array(M.bufferSize).fill(0),1);if(P+u<L.metadata.totalSamples)e=C(L,P,u),P+=i;else if(O){e=C(L,P,L.metadata.totalSamples-P);let t=e[0].length;console.log(L.metadata.totalSamples-P,u-t);let a=C(L,L.metadata.loopStartSample,u-t);for(let t=0;t<e.length;t++){let n=new Int16Array(u).fill(0);n.set(e[t]),n.set(a[t],e[t].length),e[t]=n}P=L.metadata.loopStartSample+i-t}else{e=C(L,P,L.metadata.totalSamples-P-1);for(let t=0;t<e.length;t++){let a=new Int16Array(u).fill(0);a.set(e[t]),e[t]=a}P=0,I=!0,setTimeout((function(){D.suspend()}),200)}e.length>2&&(e=[e[0],e[1]]),1===e.length&&(e=[e[0],e[0]]);for(let t=0;t<e.length;t++){let n=new Float32Array(u);for(let a=0;a<u;a++)n[a]=e[t][a]/32768;if(!R.sampleRate){let t=new T(L.metadata.sampleRate,D.sampleRate,1,n);t.resampler(u),n=t.outputBuffer,n.length>M.bufferSize&&(n=n.slice(0,M.bufferSize))}a.copyToChannel(n,t)}},x=D.createGain(),M.connect(x),x.connect(D.destination),x.gain.setValueAtTime(q,D.currentTime)}}}();
